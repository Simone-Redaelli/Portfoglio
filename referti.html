<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivio Referti - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* STILE DASHBOARD */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #0a192f; color: #ccd6f6; min-height: 100vh; padding: 40px; }

        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 1px solid #233554; padding-bottom: 20px; }
        .page-title { font-size: 2rem; color: #e6f1ff; font-weight: bold; display: flex; align-items: center; gap: 15px; }
        .back-btn { text-decoration: none; color: #64ffda; font-weight: bold; border: 1px solid #64ffda; padding: 10px 20px; border-radius: 5px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .back-btn:hover { background: rgba(100, 255, 218, 0.1); }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }

        .category-card {
            background-color: #112240; padding: 30px; border-radius: 10px; text-decoration: none; color: inherit;
            transition: transform 0.3s ease, border-color 0.3s ease; border: 1px solid transparent;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            box-shadow: 0 10px 30px -15px rgba(2,12,27,0.7); cursor: pointer;
        }
        .category-card:hover { transform: translateY(-7px); border-color: #64ffda; }
        .icon-box { font-size: 2.5rem; color: #64ffda; margin-bottom: 20px; background: rgba(100, 255, 218, 0.1); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .cat-title { font-size: 1.4rem; font-weight: 600; color: #e6f1ff; margin-bottom: 10px; }
        .cat-desc { font-size: 0.9rem; color: #8892b0; }
        .count-badge { margin-top: 15px; background: #233554; padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; color: #fff; }

        .add-new-card { border: 2px dashed #64ffda; background: transparent; }
        .add-new-card .icon-box { background: transparent; border: 2px solid #64ffda; }

        /* MODAL */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 12, 27, 0.9); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #112240; width: 600px; max-height: 80vh; border-radius: 10px;
            border: 1px solid #233554; padding: 30px; overflow-y: auto; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; color: #8892b0; cursor: pointer; }
        .close-modal:hover { color: #fff; }
        
        .file-list { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .file-item {
            background: #0a192f; padding: 15px; border-radius: 5px; border: 1px solid #233554;
            display: flex; justify-content: space-between; align-items: center;
        }
        .file-info h4 { color: #e6f1ff; margin-bottom: 5px; }
        .file-info p { font-size: 0.8rem; color: #8892b0; }
        .file-action { color: #64ffda; font-size: 1.2rem; cursor: pointer; }
        .file-action:hover { color: #fff; }
    </style>
</head>
<body>

    <div class="header-bar">
        <div class="page-title"><i class="fa-solid fa-folder-open"></i> Archivio Referti</div>
        <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Torna alla Home</a>
    </div>

    <div class="grid-container">
        <div class="category-card" onclick="apriLista('ematici', 'Esami Ematici')">
            <div class="icon-box"><i class="fa-solid fa-vial"></i></div>
            <div class="cat-title">Esami Ematici</div>
            <div class="count-badge" id="count-ematici">0 File</div>
        </div>
        <div class="category-card" onclick="apriLista('radiologia', 'Radiologia')">
            <div class="icon-box"><i class="fa-solid fa-x-ray"></i></div>
            <div class="cat-title">Radiologia</div>
            <div class="count-badge" id="count-radiologia">0 File</div>
        </div>
        <div class="category-card" onclick="apriLista('visite', 'Visite Mediche')">
            <div class="icon-box"><i class="fa-solid fa-user-doctor"></i></div>
            <div class="cat-title">Visite Mediche</div>
            <div class="count-badge" id="count-visite">0 File</div>
        </div>
        <div class="category-card" onclick="apriLista('verbali', 'Verbali Intervento')">
            <div class="icon-box"><i class="fa-solid fa-file-contract"></i></div>
            <div class="cat-title">Verbali Intervento</div>
            <div class="count-badge" id="count-verbali">0 File</div>
        </div>
        <div class="category-card" onclick="apriLista('certificati', 'Certificati')">
            <div class="icon-box"><i class="fa-solid fa-certificate"></i></div>
            <div class="cat-title">Certificati</div>
            <div class="count-badge" id="count-certificati">0 File</div>
        </div>

        <a href="crea_referto.html" class="category-card add-new-card">
            <div class="icon-box"><i class="fa-solid fa-plus"></i></div>
            <div class="cat-title">Compila Nuovo</div>
        </a>
    </div>

    <div class="modal-overlay" id="modalView">
        <div class="modal-content">
            <i class="fa-solid fa-times close-modal" onclick="chiudiModal()"></i>
            <h2 id="modalTitle" style="color:#64ffda; margin-bottom:10px;">Titolo Categoria</h2>
            
            <div class="file-list" id="listaReferti"></div>
        </div>
    </div>

    <script>
        // Carica dati
        const archivio = JSON.parse(localStorage.getItem('archivioReferti')) || [];

        function aggiornaContatori() {
            ['ematici', 'radiologia', 'visite', 'verbali', 'certificati'].forEach(cat => {
                const count = archivio.filter(r => r.categoria === cat).length;
                const el = document.getElementById('count-' + cat);
                if(el) el.innerText = count + " Documenti";
            });
        }
        aggiornaContatori();

        function apriLista(categoria, titoloBella) {
            const modal = document.getElementById('modalView');
            const listaDiv = document.getElementById('listaReferti');
            const titolo = document.getElementById('modalTitle');

            modal.style.display = 'flex';
            titolo.innerText = titoloBella;
            listaDiv.innerHTML = '';

            const refertiCategoria = archivio.filter(r => r.categoria === categoria);

            if(refertiCategoria.length === 0) {
                listaDiv.innerHTML = '<div style="text-align:center; color:#8892b0; padding:20px;">Nessun referto in questa sezione.</div>';
                return;
            }

            refertiCategoria.forEach(ref => {
                const item = document.createElement('div');
                item.className = 'file-item';
                // Notare l'onclick che chiama apriRefertoCompleto() invece dell'alert
                item.innerHTML = `
                    <div class="file-info">
                        <h4><i class="fa-solid fa-file-pdf" style="color:#e74c3c; margin-right:8px;"></i> ${ref.nome} ${ref.cognome}</h4>
                        <p>Data: ${ref.dataCreazione} | Dr. ${ref.doc_cognome || 'N/D'}</p>
                    </div>
                    <div class="file-action" onclick="apriRefertoCompleto(${ref.id})" title="Visualizza Documento">
                        <i class="fa-solid fa-eye"></i> Visualizza
                    </div>
                `;
                listaDiv.appendChild(item);
            });
        }

        // --- FUNZIONE PER APRIRE LA PAGINA VISUALIZZA.HTML ---
        function apriRefertoCompleto(id) {
            // Salviamo l'ID che vogliamo vedere nella memoria temporanea
            localStorage.setItem('refertoDaVisualizzare', id);
            // Andiamo alla pagina di visualizzazione
            window.location.href = 'visualizza.html';
        }

        function chiudiModal() {
            document.getElementById('modalView').style.display = 'none';
        }
        window.onclick = function(event) {
            if (event.target == document.getElementById('modalView')) chiudiModal();
        }
    </script>
</body>
</html>